@using Kendo.Mvc.UI;

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NASCCO</title>
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")

    <!-- EXT NET style -->
    @Styles.Render("~/bundles/ext/css")


    <!-- Primary vendor style -->
    @Styles.Render("~/bundles/font-awesome/css")
    @Styles.Render("~/bundles/animate/css")
    @Styles.Render("~/bundles/bootstrap/css")
    @Styles.Render("~/bundles/peicon7stroke/css")


    <!-- Add local styles, mostly for plugins css file -->
    @if (IsSectionDefined("Styles"))
    {
        @RenderSection("Styles", required: false)
    }

    <!-- Customize CSS -->
    @*@Styles.Render("~/bundles/custom/css")*@

    <!-- Primary HOMER style -->
    @*@Styles.Render("~/bundles/homer/css")*@

    @*Telerik*@
    <link href="@Url.Content("~/Content/kendo/2016.3.914/kendo.common.min.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/kendo/2016.3.914/kendo.material.min.css")" rel="stylesheet" type="text/css" />

    <script src="@Url.Content("~/Scripts/kendo/2016.3.914/jquery.min.js")"></script>
    <script src="@Url.Content("~/Scripts/kendo/2016.3.914/kendo.all.min.js")"></script>
    <script src="@Url.Content("~/Scripts/kendo/2016.3.914/kendo.timezones.min.js")"></script>
    <script src="@Url.Content("~/Scripts/kendo/2016.3.914/kendo.aspnetmvc.min.js")"></script>
    <script src="@Url.Content("~/Scripts/jquery.serialize-object.min.js")"></script>

    @*For Telerik Excel *@
    <script src="@Url.Content("~/Scripts/kendo/2016.3.914/jszip.min.js")"></script>


    <!-- Insurance CSS -->
    @*<link href="~/Custom/insurance.css" rel="stylesheet" />*@
    @*<link href="https://netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
        <script src="https://netdna.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
        <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>*@
    <!------ Include the above in your HEAD tag ---------->
    <script src="~/JavaScript/StyleSheet.js"></script>
    <link href="~/Custom/StyleSheet.css" rel="stylesheet" />

</head>
<body>
    

    @*top menu*@
    @*<div class="navbar navbar-inverse navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    @Html.ActionLink("Application name", "Index", "Home", new { area = "" }, new { @class = "navbar-brand" })
                </div>
                <div class="navbar-collapse collapse">
                    <ul class="nav navbar-nav">
                        <li>@Html.ActionLink("Home", "Index", "Home")</li>
                        <li>@Html.ActionLink("About", "About", "Home")</li>
                        <li>@Html.ActionLink("Contact", "Contact", "Home")</li>
                    </ul>
                    @Html.Partial("_LoginPartial")
                </div>
            </div>
        </div>*@
    <!--- Working -->

    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
               
               

            </div>
            
            <div class="navbar-collapse collapse">
                @*<ul class="nav navbar-nav">
                    <li>@Html.ActionLink("Home", "Index", "Home")</li>
                    <li>@Html.ActionLink("About", "About", "Home")</li>
                    <li>@Html.ActionLink("Contact", "Contact", "Home")</li>
                </ul>*@
                @Html.Partial("_LoginPartial")
            </div>
        </div>
    </div>
    <div class="col-md-2 col-sm-2 card-sidebar">
        @*<div class="sidebar">
                @Html.ActionLink("Home", "index", "Home", null, new { @class = "active" })
                @Html.ActionLink("Groups & Members", "GroupView", "Group", null, new { @id = "GroupListMenu_" })
                @Html.ActionLink("Insurance Options", "Index", "Options", null, new { @id = "OptionsMenu_" })
            </div>*@
        <nav class="navbar navbar-inverse sidebar" role="navigation">
            <div class="container-fluid">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-sidebar-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    
                    <a href='@Url.Action("MyAction", "MyController")'>
                        <img src="~/Images/NasccoLogo.png" class="img-responsive m-t-20" style="max-width: 218px; margin-left: -10px;">
                    </a>
                </div>
                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-sidebar-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="/home/index">Home<span style="font-size:16px;" class="pull-right hidden-xs showopacity glyphicon glyphicon-home"></span></a></li>
                        <li><a href="/Group/GroupView">Groups & Members<span style="font-size:16px;" class="pull-right hidden-xs showopacity glyphicon glyphicon-user"></span></a></li>
                        @*<li><a href="/Options/Index">Insurance Options<span style="font-size:16px;" class="pull-right hidden-xs showopacity glyphicon glyphicon-envelope"></span></a></li>*@
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Settings <span class="caret"></span><span style="font-size:16px;" class="pull-right hidden-xs showopacity glyphicon glyphicon-cog"></span></a>
                            <ul class="dropdown-menu forAnimate" role="menu">
                                <li><a href="/Options/Index">Insurance Options<span style="font-size:16px;" class="pull-right hidden-xs showopacity glyphicon glyphicon-envelope"></span></a></li>
                                <li class="divider"></li>
                                <li><a href="/UserAccount/Index">User Account<span style="font-size:16px;" class="pull-right hidden-xs showopacity glyphicon glyphicon-user"></span></a></li>

                                @*<li><a href="#">Another action</a></li>
                                    <li><a href="#">Something else here</a></li>
                                    <li class="divider"></li>
                                    <li><a href="#">Separated link</a></li>
                                    <li class="divider"></li>
                                    <li><a href="#">One more separated link</a></li>*@
                            </ul>
                        </li>
                        @*<li><a href="#">Home<span style="font-size:16px;" class="pull-right hidden-xs showopacity glyphicon glyphicon-home"></span></a></li>
                            <li><a href="#">Profile<span style="font-size:16px;" class="pull-right hidden-xs showopacity glyphicon glyphicon-user"></span></a></li>
                            <li><a href="#">Messages<span style="font-size:16px;" class="pull-right hidden-xs showopacity glyphicon glyphicon-envelope"></span></a></li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Settings <span class="caret"></span><span style="font-size:16px;" class="pull-right hidden-xs showopacity glyphicon glyphicon-cog"></span></a>
                                <ul class="dropdown-menu forAnimate" role="menu">
                                    <li><a href="#">Action</a></li>
                                    <li><a href="#">Another action</a></li>
                                    <li><a href="#">Something else here</a></li>
                                    <li class="divider"></li>
                                    <li><a href="#">Separated link</a></li>
                                    <li class="divider"></li>
                                    <li><a href="#">One more separated link</a></li>
                                </ul>
                            </li>*@
                    </ul>
                </div>
            </div>
        </nav>
    </div>
    <!-- Sidebar -->

    <div class="container body-content col-md-8 col-sm-8">
        @RenderBody()
        <hr />
        <footer>
            <p>&copy; @DateTime.Now.Year - NASCCO</p>
        </footer>
    </div>




    @*@Scripts.Render("~/bundles/jquery")*@
    @Scripts.Render("~/bundles/bootstrap")
    @RenderSection("scripts", required: false)
</body>
</html>

@Html.Partial("~/Views/Common/Window.cshtml")
<script>

    

    $(document).on('change', '#Transaction_CC_Processor_Id', function () {
        $('.processors').removeClass('hidden');      
        var id = $('#Transaction_CC_Processor_Id').val();
        if (id == 1) {
            $('.c2b').addClass('hidden');
            $('.lipa').addClass('hidden');
            $('.b2b').addClass('hidden');
            $('.b2c').removeClass('hidden');
        }
        else if (id == 2) {
            $('.b2c').addClass('hidden');
            $('.lipa').addClass('hidden');
            $('.b2b').addClass('hidden');
            $('.c2b').removeClass('hidden');
        }
        else if (id == 3) {
            $('.b2c').addClass('hidden');
            $('.c2b').addClass('hidden');
            $('.b2b').addClass('hidden');
            $('.lipa').removeClass('hidden');
        }
        else if (id == 4) {
            $('.b2c').addClass('hidden');
            $('.c2b').addClass('hidden');
            $('.lipa').addClass('hidden');
            $('.b2b').removeClass('hidden');
        }
        else {
            $('.processors').addClass('hidden');      
        }
    });

    function onClick_CreateUserAccount(e) {
        e.preventDefault();
        var window = $("#window_UserAccountCreate").data("kendoWindow");
        window.center().refresh().open();
    }

    function onClick_CancelUserAccount(e) {
        e.preventDefault();
        var window = $("#window_UserAccountCreate").data("kendoWindow");
        window.close();
    }

    function onClick_EditUserAccount(e) {
    e.preventDefault();
        var window = $("#window_UserAccountCreate").data("kendoWindow")
    window.center().open();
        var dataItem = $("#GridUserAccount").data("kendoGrid").dataItem($(e.currentTarget).closest("tr"));
        var id = dataItem.User_Acccount_Id;
    $.ajax({
        url: '@Url.Action("GetUserAccountDetail", "UserAccount")',
        data: { Id: id },
        dataType: "html",
        success: function (data) {
            $("#window_UserAccountCreate").html(data);
        }
    });
}

    function onClick_SaveUserAccount(e) {
        e.preventDefault();
        var window = $("#window_UserAccountCreate").data("kendoWindow");
        var url = $("#UserAccountCreateForm").attr("action");
        var dataItems = $("#UserAccountCreateForm").serialize();
        var grid = $("#GridUserAccount").data("kendoGrid");

        $.ajax({
            url: url,
            type: 'POST',
            data: dataItems,
            dataType: 'json',
            success: function (result) {
                $("#er_notifyMsg_user_account").html(result.message);
                $("#er_notify_user_account").removeClass("hidden");

                if (result.result == "success") {
                    window.close();
                    grid.dataSource.read();
                    grid.refresh();
                }
            },
            error: function (result) {

                $("#er_notifyMsg_user_account").html(result.message);
                $("#er_notify_user_account").removeClass("hidden");

                grid.dataSource.read();
                grid.refresh();
            }
        });

    }

    function onClick_UpdateUserAccount(e) {
    e.preventDefault();
    var url = "@Url.Action("UpdateUserAccount", "UserAccount")";
        var dataItems = $("#UserAccountCreateForm").serialize();
        var window = $("#window_UserAccountCreate").data("kendoWindow");
        var grid = $("#GridUserAccount").data("kendoGrid");

    $.ajax({
        url: url,
        type: 'POST',
        data: dataItems,
        dataType: 'json',
        success: function (result) {
            $("#er_notifyMsg_user_account").html(result.message);
            $("#er_notify_user_account").removeClass("hidden");

            if (result.result == "success") {
                window.close();
                grid.dataSource.read();
                grid.refresh();

            }


        },

        error: function (result) {

            $("#er_notifyMsg_user_account").html(result.message);
            $("#er_notify_user_account").removeClass("hidden");

            grid.dataSource.read();
            grid.refresh();
        }

    });
    }

    function onClick_DeleteUserAccount(e) {
    e.preventDefault();
    
    var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
    var wnd = $("#window_Record").data("kendoWindow");
    var grid = $("#GridUserAccount").data("kendoGrid");
    $("#window_Record h4").html("Are you sure you want to delete this record?");
    wnd.center().open();
        var description = dataItem.User_Account_Full_Name;
    var values = {
        Id: dataItem.User_Acccount_Id
    };

    $("#window_Record > div > div > #Yes").click(function () {
        wnd.close();
        $.ajax({
            dataType: "json",
            type: "POST",
            url: "@(Url.Action("RemoveUserAccount", "UserAccount"))",
            data: values,
            success: function (data) {
                $("#er_notifyMsg_options_delete_user_account").html("User " + description + " currently in used.");
                $("#er_notify_options_delete_user_account").removeClass("hidden");
                //alert(data.result);
                if (data.result == "success") {
                    $("#er_notify_options_delete_user_account").addClass("hidden");
                    window.close();
                    grid.dataSource.read();
                    grid.refresh();

                }


            },

            error: function (data) {

                $("#er_notifyMsg_options_delete_user_account").html(data.message);
                $("#er_notify_options_delete_user_account").removeClass("hidden");

                grid.dataSource.read();
                grid.refresh();
            }
            //success: function (result) {
            //    var grid = $("#GridOptionsMf").data("kendoGrid");
            //    grid.dataSource.read();
            //}
        });

    });

    $("#window_Record > div > div > #No").click(function () {
        wnd.close();
    });
};

    function onClick_CancelOptions(e) {
        e.preventDefault();
        var window = $("#window_OptionsCreate").data("kendoWindow");
        window.close();
    }

function onClick_SaveOptions(e) {
    e.preventDefault();
    var window = $("#window_OptionsCreate").data("kendoWindow");
    var url = $("#OptionsCreateForm").attr("action");
    var dataItems = $("#OptionsCreateForm").serialize();
    var grid = $("#GridOptionsMf").data("kendoGrid");

    $.ajax({
        url: url,
        type: 'POST',
        data: dataItems,
        dataType: 'json',
        success: function (result) {
            $("#er_notifyMsg_options").html(result.message);
            $("#er_notify_options").removeClass("hidden");

            if (result.result == "success") {
                window.close();
                grid.dataSource.read();
                grid.refresh();
            }
        },
        error: function (result) {

            $("#er_notifyMsg_options").html(result.message);
            $("#er_notify_options").removeClass("hidden");

            grid.dataSource.read();
            grid.refresh();
        }
    });

}

function onClick_UpdateOptions(e) {
    e.preventDefault();
    var url = "@Url.Action("UpdateOptions", "Options")";
    var dataItems = $("#OptionsCreateForm").serialize();
    var window = $("#window_OptionsCreate").data("kendoWindow");
    var grid = $("#GridOptionsMf").data("kendoGrid");

    $.ajax({
        url: url,
        type: 'POST',
        data: dataItems,
        dataType: 'json',
        success: function (result) {
            $("#er_notifyMsg_options").html(result.message);
            $("#er_notify_options").removeClass("hidden");

            if (result.result == "success") {
                window.close();
                grid.dataSource.read();
                grid.refresh();

            }


        },

        error: function (result) {

            $("#er_notifyMsg_options").html(result.message);
            $("#er_notify_options").removeClass("hidden");

            grid.dataSource.read();
            grid.refresh();
        }

    });
}

function onClick_DeleteOptions(e) {
    e.preventDefault();
    var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
    var wnd = $("#window_Record").data("kendoWindow");
    var grid = $("#GridOptionsMf").data("kendoGrid");
    $("#window_Record h4").html("Are you sure you want to delete this record?");
    wnd.center().open();
    var description = dataItem.Options_Description_Mf + " " + dataItem.Options_Option_Description_Mf;
    var values = {
        Id: dataItem.Options_Id_Mf
    };

    $("#window_Record > div > div > #Yes").click(function () {
        wnd.close();
        $.ajax({
            dataType: "JSON",
            type: "POST",
            url: "@(Url.Action("RemoveOptions", "Options"))",
            data: values,
            success: function (data) {
                $("#er_notifyMsg_options_delete").html("Record " + description + " currently in used.");
                $("#er_notify_options_delete").removeClass("hidden");
                //alert(data.result);
                if (data.result == "success") {
                    $("#er_notify_options_delete").addClass("hidden");
                    window.close();
                    grid.dataSource.read();
                    grid.refresh();

                }


            },

            error: function (data) {

                $("#er_notifyMsg_options_delete").html(data.message);
                $("#er_notifyMsg_options_delete").removeClass("hidden");

                grid.dataSource.read();
                grid.refresh();
            }
            //success: function (result) {
            //    var grid = $("#GridOptionsMf").data("kendoGrid");
            //    grid.dataSource.read();
            //}
        });

    });

    $("#window_Record > div > div > #No").click(function () {
        wnd.close();
    });
};




function onClick_EditOptions(e) {
    e.preventDefault();
    var window = $("#window_OptionsCreate").data("kendoWindow")
    window.center().open();
    var dataItem = $("#GridOptionsMf").data("kendoGrid").dataItem($(e.currentTarget).closest("tr"));
    var id = dataItem.Options_Id_Mf;
    $.ajax({
        url: '@Url.Action("GetOptionsDetail", "Options")',
        data: { Id: id },
        dataType: "html",
        success: function (data) {
            $("#window_OptionsCreate").html(data);
        }
    });
}

function onClick_CreateOptions(e) {
    e.preventDefault();
    var window = $("#window_OptionsCreate").data("kendoWindow");
    window.center().refresh().open();
}



function onChange_Date(e) {
    var dt = e.sender;
    var value = dt.value();

    if (value === null) {
        value = kendo.parseDate(dt.element.val(), dt.options.parseFormats);
    }

    if (value < dt.min()) {
        dt.value(dt.min());
    } else if (value > dt.max()) {
        dt.value(dt.max());
    }
}

var GlobalGroupId = 0;
function filterByGroupId() {
    return {
        Group_Id: GlobalGroupId
    };
}

function onClick_CancelTransaction(e) {
    var window = $("#window_TransactionCreate").data("kendoWindow");
    window.close();
}

function onClick_SaveTransaction(e) {
    e.preventDefault();
    var window = $("#window_TransactionCreate").data("kendoWindow");
    var window_processing = $("#window_processing").data("kendoWindow");
    var url = $("#TransactionPaymentForm").attr("action");
    var dataItems = $("#TransactionPaymentForm").serialize();
    //var grid = $("#GridGroup").data("kendoGrid");
    window_processing.center().open();
    $.ajax({
        url: url,
        type: 'POST',
        data: dataItems,
        dataType: 'json',
        success: function (result) {
            $("#er_notifyMsg_transaction").html(result.message);
            $("#er_notify_transaction").removeClass("hidden");

            if (result.result == "success") {
                RefreshGridTransactionPayment();
                window_processing.close();
                window.close();
            }
            else {
                window_processing.close();
            }
        },
        error: function (result) {

            $("#er_notifyMsg_transaction").html(result.result, result.message);
            $("#er_notify_transaction").removeClass("hidden");
            window_processing.close();

        }
    });

}

function onClick_CreateTransaction(e) {

    e.preventDefault();
    var window = $("#window_TransactionCreate").data("kendoWindow")
    window.center().open();
    var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
    var Customer_Id = dataItem.Customer_Id;
    //GlobalGroupId = Group_Id;

    $.ajax({
        url: '@Url.Action("Create", "Transaction")',
        data: { Customer_Id: Customer_Id },
        dataType: "html",
        success: function (data) {
            $("#window_TransactionCreate").html(data);
        }
    });

    //e.preventDefault();
    //var window = $("#window_TransactionCreate").data("kendoWindow");
    //window.center().refresh().open();
}

function onRowBound_GridPanel_GridGroup() {
    $(".k-grid-SalesByUser").find("span").addClass("fa fa-credit-card");
    $(".k-grid-Sales").find("span").addClass("fa fa-credit-card-alt");
    $(".k-grid-Cancel").find("span").addClass("fa fa-times");
    $(".k-grid-Delete").find("span").addClass("fa fa-trash-o fa-fw");
    $(".k-grid-Edit").find("span").addClass("fa fa-pencil");
    $(".k-grid-ViewMember").find("span").addClass("fa fa-eye");
    $(".k-grid-DetailInvoice").find("span").addClass("fa fa-list-ol");
    $(".k-grid-AddMember").find("span").addClass("fa fa-plus");
    $(".k-grid-Transaction").find("span").addClass("fa fa-money");

}



$("#GroupListMenu").click(function (e) {
    e.preventDefault();
    var window = $("#window_GroupList").data("kendoWindow");
    window.refresh().center().open();
});

//delete
//function onClick_DeleteGroup(e) {
//    //Initialized
//};
function onClick_DeleteGroup(e) {
    var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
    var wnd = $("#window_Record").data("kendoWindow");
    //var window_processing = $("#window_processing").data("kendoWindow");
    $("#window_Record h4").html("Are you sure you want to delete this record?");
    wnd.center().open();
    e.preventDefault();
    var values = {
        Id: dataItem.Group_Id
    };

    $("#window_Record > div > div > #Yes").click(function () {
        wnd.close();
        $.ajax({
            dataType: "html",
            type: "POST",
            url: "@(Url.Action("RemoveGroup", "Group"))",
            data: values,
            success: function (result) {
                var grid = $("#GridGroup").data("kendoGrid");
                grid.dataSource.read();
            }
        });

    });

    $("#window_Record > div > div > #No").click(function () {
        wnd.close();
    });
};


function onClick_DeleteMember(e) {
    var dataItem = $("#GridGroupOptions").data("kendoGrid").dataItem($(e.currentTarget).closest("tr"));
    var wnd = $("#window_Record").data("kendoWindow");
    //var window_processing = $("#window_processing").data("kendoWindow");
    $("#window_Record h4").html("Are you sure you want to delete this record?");
    wnd.center().open();
    e.preventDefault();
    var values = {
        Member_Id: dataItem.Group_Option_Member_Id
    };

    $("#window_Record > div > div > #Yes").click(function () {
        wnd.close();
        $.ajax({
            dataType: "html",
            type: "POST",
            url: "@(Url.Action("RemoveMember", "Group"))",
            data: values,
            success: function (result) {
                RefreshGridGroupOptions();
                GetTotal();
            }
        });

    });

    $("#window_Record > div > div > #No").click(function () {
        wnd.close();
    });
};


function onClick_EditGroup(e) {
    e.preventDefault();    
    var window = $("#window_GroupCreate").data("kendoWindow")
    window.center().open();
    var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
    var id = dataItem.Customer_Id;
    $.ajax({
        url: '@Url.Action("GetGroupDetail", "Group")',
        data: { Id: id },
        dataType: "html",
        success: function (data) {
            $("#window_GroupCreate").html(data);
        }
    });
}

function onClick_UpdateGroup(e) {
    e.preventDefault();
    var url = "@Url.Action("UpdateGroup", "Group")";
    var dataItems = $("#newGroupCreateForm").serialize();
    var window = $("#window_GroupCreate").data("kendoWindow");
    var grid = $("#GridGroup").data("kendoGrid");

    $.ajax({
        url: url,
        type: 'POST',
        data: dataItems,
        dataType: 'json',
        success: function (result) {
            $("#er_notifyMsg").html(result.message);
            $("#er_notify").removeClass("hidden");

            if (result.result == "success") {
                window.close();
                grid.dataSource.read();
                grid.refresh();

                RefreshGridGroupOptions();
                RefreshGridTransactionPayment();
            }


        },

        error: function (result) {

            $("#er_notifyMsg").html(result.message);
            $("#er_notify").removeClass("hidden");

            grid.dataSource.read();
            grid.refresh();
        }

    });
}

function onClick_AddMemberGroup(e) {
    e.preventDefault();
    var window = $("#window_MemberCreate").data("kendoWindow")
    window.center().open();
    var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
    var Group_Id = dataItem.Group_Id;

    GlobalGroupId = Group_Id;

    $.ajax({
        url: '@Url.Action("AddMember", "Group")',
        data: { Group_Id: Group_Id },
        dataType: "html",
        success: function (data) {
            $("#window_MemberCreate").html(data);
        }
    });
}

function onClick_SaveMember(e) {
    e.preventDefault();
    var window = $("#window_MemberCreate").data("kendoWindow");
    var url = $("#newMemberCreateForm").attr("action");
    var dataItems = $("#newMemberCreateForm").serialize();
    //var grid = $("#GridGroup").data("kendoGrid");

    $.ajax({
        url: url,
        type: 'POST',
        data: dataItems,
        dataType: 'json',
        success: function (result) {
            $("#er_notifyMsg_member").html(result.message);
            $("#er_notify_member").removeClass("hidden");

            if (result.result == "success") {
                RefreshGridGroupOptions();
                GetTotal();
                window.close();
            }
        },
        error: function (result) {

            $("#er_notifyMsg_member").html(result.result, result.message);
            $("#er_notify_member").removeClass("hidden");

            //grid.dataSource.read();
            //grid.refresh();
        }
    });

}

function onClick_UpdateMember(e) {
    e.preventDefault();
}

function onClick_EditMember(e) {

    e.preventDefault();
    var window = $("#window_MemberEdit").data("kendoWindow")
    window.center().open();
    var dataItem = $("#GridGroupOptions").data("kendoGrid").dataItem($(e.currentTarget).closest("tr"));
    var id = dataItem.Group_Option_Member_Id;
    $.ajax({
        url: '@Url.Action("GetMemberDetail", "Group")',
        data: { Member_Id: id },
        dataType: "html",
        success: function (data) {
            $("#window_MemberEdit").html(data);

        }
    });
}




function onClick_CancelMember(e) {
    var window = $("#window_MemberCreate").data("kendoWindow");
    window.close();
}

function RefreshGridGroupOptions() {

    var grid = $("#GridGroupOptions").data("kendoGrid");
    grid.dataSource.read();
    grid.refresh();


}

function RefreshGridTransactionPayment() {

    var grid = $("#GridPaymentTransaction").data("kendoGrid");
    grid.dataSource.read();
    grid.refresh();


}
function onClick_ViewMemberGroup(e) {
    e.preventDefault();
    var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
    var id = dataItem.Group_Id;
    GlobalGroupId = id;
    $(".group_attribute").removeClass("hidden");

    RefreshGridGroupOptions();
    RefreshGridTransactionPayment();
    GetTotal();
}


function GetTotal() {
    $.get('@Url.Action("GrandTotalPerGroup", "Group")', { Group_Id: GlobalGroupId }, function (data) {
        $("#GrandTotalPerGroup").html("Total Payable: " + data.amount);
    });
}


function onClick_CreateGroup(e) {
    e.preventDefault();
    var window = $("#window_GroupCreate").data("kendoWindow");
    window.center().refresh().open();
}



function onClick_SaveGroup(e) {
    e.preventDefault();
    var window = $("#window_GroupCreate").data("kendoWindow");
    var url = $("#newGroupCreateForm").attr("action");
    var dataItems = $("#newGroupCreateForm").serialize();
    var grid = $("#GridGroup").data("kendoGrid");

    $.ajax({
        url: url,
        type: 'POST',
        data: dataItems,
        dataType: 'json',
        success: function (result) {
            $("#er_notifyMsg").html(result.message);
            $("#er_notify").removeClass("hidden");

            if (result.result == "success") {
                window.close();
                grid.dataSource.read();
                grid.refresh();
            }
        },
        error: function (result) {

            $("#er_notifyMsg").html(result.result, result.message);
            $("#er_notify").removeClass("hidden");

            grid.dataSource.read();
            grid.refresh();
        }
    });

}


function onClick_UpdateMember(e) {
    e.preventDefault();
    var url = "@Url.Action("UpdateMember", "Group")";
    var dataItems = $("#newMemberUpdateForm").serialize();
    var window = $("#window_MemberEdit").data("kendoWindow");
    //var grid = $("#GridGroupOptions").data("kendoGrid");

    $.ajax({
        url: url,
        type: 'POST',
        data: dataItems,
        dataType: 'json',
        success: function (result) {
            $("#er_notifyMsg_member_update").html(result.message);
            $("#er_notify_member_update").removeClass("hidden");

            if (result.result == "success") {
                window.close();
                //grid.dataSource.read();
                //grid.refresh();

                RefreshGridGroupOptions();
                RefreshGridTransactionPayment();
                GetTotal();
            }


        },

        error: function (result) {

            $("#er_notifyMsg_member_update").html(result.message);
            $("#er_notify_member_update").removeClass("hidden");

            RefreshGridGroupOptions();
            RefreshGridTransactionPayment();
            GetTotal();
            //grid.dataSource.read();
            //grid.refresh();
        }

    });
}



function onClick_CancelGroup(e) {
    e.preventDefault();
    var window = $("#window_GroupCreate").data("kendoWindow");
    window.close();
}

function onClick_CancelMemberEdit(e) {
    e.preventDefault();
    var window = $("#window_MemberEdit").data("kendoWindow");
    window.close();
}
</script>





